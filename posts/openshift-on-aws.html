<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v9.1.6 <https://hydejack.com/>
--><head><title>Run OpenShift on AWS | Partly Cloudy</title><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Run OpenShift on AWS" /><meta name="author" content="Josh Gavant" /><meta property="og:locale" content="en" /><meta name="description" content="Summary: Descriptions and simple scripts for supported ways to deploy OpenShift on Amazon Web Services - ROSA, IPI and UPI." /><meta property="og:description" content="Summary: Descriptions and simple scripts for supported ways to deploy OpenShift on Amazon Web Services - ROSA, IPI and UPI." /><link rel="canonical" href="https://blog.joshgav.com//posts/openshift-on-aws" /><meta property="og:url" content="https://blog.joshgav.com//posts/openshift-on-aws" /><meta property="og:site_name" content="Partly Cloudy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-09T07:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Run OpenShift on AWS" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Josh Gavant"},"dateModified":"2022-08-09T07:00:00+00:00","datePublished":"2022-08-09T07:00:00+00:00","description":"Summary: Descriptions and simple scripts for supported ways to deploy OpenShift on Amazon Web Services - ROSA, IPI and UPI.","headline":"Run OpenShift on AWS","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.joshgav.com//posts/openshift-on-aws"},"url":"https://blog.joshgav.com//posts/openshift-on-aws"}</script><meta name="theme-color" content="rgb(25,55,71)"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Partly Cloudy"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="application-name" content="Partly Cloudy"><meta name="generator" content="Hydejack v9.1.6" /><link rel="alternate" href="https://blog.joshgav.com//posts/openshift-on-aws" hreflang="en"><link type="application/atom+xml" rel="alternate" href="https://blog.joshgav.com//feed.xml" title="Partly Cloudy" /><link rel="shortcut icon" href="/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG"> <script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script"),e=(n.src=e,t&&a(n,"load",t,{once:!0}),c.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w) { w._baseURL = '/'; w._publicPath = '/assets/js/'; w._noPushState = false; w._noDrawer = false; w._noNavbar = false; w._noToc = false; w._noSearch = false; w._search = { DATA_URL: '/assets/sitedata.json?no-cache', STORAGE_KEY: 'mini-search/', INDEX_KEY: 'index--2023-10-15T17:38:27+00:00', }; w._clapButton = false; }(window);</script> <!--[if gt IE 8]><!----><style id="_styleInline"> .clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,.content .avatar,.nav-btn,.nav-btn-bar,.navbar,.message,.note-sm,#markdown-toc,.note,.hr-bottom,.hr-after::after,hr,.hr,p,body{transition:none}html{--font-family: Noto Sans, Helvetica, Arial, sans-serif;--font-family-heading: Roboto Slab, Helvetica, Arial, sans-serif;--code-font-family: ui-monospace, Menlo, Monaco, Cascadia Mono, Segoe UI Mono, Roboto Mono, Oxygen Mono, Ubuntu Monospace, Source Code Pro, Fira Mono, Droid Sans Mono, Courier New, monospace;--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0, 0, 0, 0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: #282828;--root-font-size: 15px;--root-font-size-medium: 16px;--root-font-size-large: 17px;--root-font-size-print: 8pt;--root-line-height: 1.75;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 700;--content-width-5: 54rem;--content-margin-5: 4rem;--sidebar-width: 21rem;--half-content: 31rem;--break-point-3: 64em;--break-point-5: 86em;--break-point-dynamic: 1664px}html .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:var(--font-family);font-size:var(--root-font-size);line-height:var(--root-line-height)}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}.content img,.img,.content video,.video{max-width:100%;height:auto}.lead{margin-left:-1rem;margin-right:-1rem;margin-bottom:1.5rem}img.lead,video.lead{display:block;max-width:calc(100% + 2rem);width:calc(100% + 2rem);height:auto}.heading,.f6,h6,.h6,.f5,h5,.h5,.f4,.sidebar-nav-item,h4,.h4,.post-date,.f3,h3,.h3,.f2,h2,.h2,.f1,h1,.h1{font-family:var(--font-family-heading);font-weight:var(--font-weight-heading)}.f1,h1,.h1{font-size:2rem;line-height:1.3}.f2,h2,.h2{font-size:1.5rem;line-height:1.4}.f3,h3,.h3{font-size:1.2em;line-height:1.5}.f4,.sidebar-nav-item,h4,.h4,.post-date{font-size:1.08rem;line-height:1.6}.f5,h5,.h5{font-size:1.04rem;line-height:1.7}.f6,h6,.h6{font-size:1rem}.content h1>a,.content .h1>a{text-decoration:none;border-bottom:none}@media screen and (max-width: 42em){.content h1,.content .h1{font-size:1.7rem;line-height:1.35}}@media screen and (min-width: 86em){.content h1,.content .h1{font-size:2.4rem;line-height:1.25}}@media screen and (min-width: 1664px){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{width:calc(100% + 50vw - 32rem);font-size:3rem;line-height:1.2}}@media screen and (min-width: 124em){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{font-size:4rem;line-height:1.1}}h1,h2,h3,.h1,.h2,.h3{margin:4rem 0 1rem}h4,h5,h6,.h4,.post-date,.h5,.h6{margin:3rem 0 .5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr,.hr{border:0;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-after::after{content:"";display:block;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-bottom{border-bottom:1px solid var(--border-color);padding-bottom:.75rem;margin-bottom:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{position:relative;margin-bottom:2rem}@media screen and (min-width: 1664px){body:not(.no-third-column) .page>header>.lead+.note-sm,body:not(.no-third-column) .page>header>.lead+#markdown-toc,body:not(.no-third-column) .page>header>.lead+.note,body:not(.no-third-column) .page>header>a.no-hover+.note-sm,body:not(.no-third-column) .page>header>a.no-hover+#markdown-toc,body:not(.no-third-column) .page>header>a.no-hover+.note{position:absolute;right:-25rem;width:21rem;bottom:0;margin-bottom:0}}.page-title,.post-title{margin-top:0}.post-date{display:flex;justify-content:space-between;margin-top:-0.6rem;height:2rem;margin-bottom:.85rem;color:var(--gray)}.post-date>.ellipsis,#breadcrumbs.post-date>ul{cursor:pointer}.post-date [class^=icon-]{display:inline-block;font-size:smaller;margin-right:.25rem}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message,.note-sm,#markdown-toc,.note{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}.note-sm,#markdown-toc,.note{background:rgba(0,0,0,0);color:var(--body-color);font-size:smaller;border-left:1px solid var(--border-color);padding:1.2rem 1rem 0 1rem;margin:1rem -1rem;position:relative}.note-sm:before,#markdown-toc:before,.note:before{font-size:.667rem;font-weight:bold;font-style:normal;letter-spacing:.025rem;text-transform:uppercase;color:var(--menu-text);position:absolute;top:0}.note-sm[title]:before,[title]#markdown-toc:before,[title].note:before{content:attr(title) !important}.note{font-size:1rem}@media screen{body::before{content:"";width:.5rem;background:var(--gray-bg);position:fixed;left:0;top:0;bottom:0}}@media(min-width: 64em){body::before{width:21rem}}@media(min-width: 1664px){body::before{width:calc(50% - 31rem)}}@media screen and (min-width: 42em){html{font-size:var(--root-font-size-medium)}}@media screen and (min-width: 124em){html{font-size:var(--root-font-size-large)}}#breadcrumbs>ul{height:1rem;margin:-1.5rem 0 .5rem;padding:0;font-size:.667rem;color:var(--menu-text);text-transform:uppercase;width:100%;list-style:none}#breadcrumbs>ul>li{display:inline}#breadcrumbs>ul>li a{color:var(--gray);text-decoration:none;border-bottom:none}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt1{margin-top:1rem}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.ml1{margin-left:1rem}.mr1{margin-right:1rem}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sixteen-ten{position:relative}.sixteen-ten::before{display:block;content:"";width:100%;padding-top:62.5%}.sixteen-ten>*{position:absolute;top:0;left:0;right:0;bottom:0}.four-three{position:relative}.four-three::before{display:block;content:"";width:100%;padding-top:75%}.four-three>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.larger{font-size:larger}.smaller{font-size:smaller}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.ellipsis,#breadcrumbs>ul{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border{border:1px solid var(--border-color)}@media(min-width: 42em){.border-radius,.lead,.page .aspect-ratio.sixteen-nine.lead{border-radius:.5rem}}.fallback-img{background-position:center;background-repeat:no-repeat;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDQ4ODI4LCAwLCAwLCAwLjA0Nzk5MSwgNTQuOTk5OTczLCAyMC40MjgxNDgpIj4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTk1OS44ODQgMTI4YzAuMDQwIDAuMDM0IDAuMDgyIDAuMDc2IDAuMTE2IDAuMTE2djc2Ny43N2MtMC4wMzQgMC4wNDAtMC4wNzYgMC4wODItMC4xMTYgMC4xMTZoLTg5NS43N2MtMC4wNDAtMC4wMzQtMC4wODItMC4wNzYtMC4xMTQtMC4xMTZ2LTc2Ny43NzJjMC4wMzQtMC4wNDAgMC4wNzYtMC4wODIgMC4xMTQtMC4xMTRoODk1Ljc3ek05NjAgNjRoLTg5NmMtMzUuMiAwLTY0IDI4LjgtNjQgNjR2NzY4YzAgMzUuMiAyOC44IDY0IDY0IDY0aDg5NmMzNS4yIDAgNjQtMjguOCA2NC02NHYtNzY4YzAtMzUuMi0yOC44LTY0LTY0LTY0djB6Ii8+CiAgICA8cGF0aCBzdHlsZT0iZmlsbDpyZ2JhKDEyOCwxMjgsMTI4LC4zMykiIGQ9Ik04MzIgMjg4YzAgNTMuMDIwLTQyLjk4IDk2LTk2IDk2cy05Ni00Mi45OC05Ni05NiA0Mi45OC05NiA5Ni05NiA5NiA0Mi45OCA5NiA5NnoiLz4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTg5NiA4MzJoLTc2OHYtMTI4bDIyNC0zODQgMjU2IDMyMGg2NGwyMjQtMTkyeiIvPgogIDwvZz4KPC9zdmc+")}hy-push-state a{color:var(--body-color)}@supports not ((text-decoration-thickness: initial) and (text-underline-offset: initial)){hy-push-state a{text-decoration:none;border-bottom:2px solid}}@supports(text-decoration-thickness: initial) and (text-underline-offset: initial){hy-push-state a{text-decoration-style:solid;text-underline-offset:.35rem;text-decoration-thickness:2px}}hy-push-state a.no-hover{border-bottom:none;text-decoration-thickness:unset;text-underline-offset:unset}.content a:not(.btn):not(.no-hover){border-color:var(--accent-color-faded)}@supports(text-decoration-thickness: initial) and (text-underline-offset: initial){.content a:not(.btn):not(.no-hover){text-decoration-color:var(--accent-color-faded)}}.content .aspect-ratio{overflow:hidden}.content .aspect-ratio img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden;display:block;z-index:4}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 1664px){hy-drawer{width:calc(50% - 31rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,.75);text-align:center;min-height:100vh}.sidebar.invert{color:rgba(32,32,32,.75)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,.2);text-decoration-color:rgba(255,255,255,.2)}.sidebar.invert a{color:#222;border-bottom-color:rgba(32,32,32,.2);text-decoration-color:rgba(32,32,32,.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center/cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32, 32, 32, 0) 0%, rgba(32, 32, 32, 0.5) 50%, rgba(32, 32, 32, 0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>a.sidebar-title{text-decoration:none}.sidebar-about>a.sidebar-title>h2{margin:0;padding-bottom:.5rem}.sidebar-about>a.sidebar-title::after{content:"";display:block;border-bottom:2px solid;margin:0 auto .5rem;width:4rem;border-color:rgba(255,255,255,.2);transition:border-color 250ms}.sidebar-about>a.sidebar-title:hover::after{border-color:#fff;transition:border-color 50ms}.sidebar.invert .sidebar-about>a.sidebar-title::after{border-color:rgba(32,32,32,.2)}.sidebar.invert .sidebar-about>a.sidebar-title:hover::after{border-color:#222}.sidebar-nav>ul{list-style:none;padding-left:0}.sidebar-nav-item{display:inline-block;margin-bottom:.5rem}@media(min-width: 64em){#_main.no-drawer #_menu{display:none}#_main.no-drawer .nav-btn-bar>:nth-child(2){border:none}}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem;text-decoration:none;border-bottom-width:2px;border-bottom-style:solid}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-bottom,.fixed-top{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{position:relative;padding-top:0;padding-bottom:0;min-height:0;max-height:5rem}.nav-btn-bar{margin:0 -1rem;background-color:#fff;background-color:var(--body-bg);height:5rem;display:flex;align-items:center;position:relative}.nav-btn-bar>:first-child,.nav-btn-bar>:last-child{border:none}.nav-btn{background:none;border:none;text-decoration:none;display:flex;align-items:center;justify-content:center;width:3.25rem;height:5rem;color:var(--menu-text);border-right:1px solid var(--border-color);border-left:1px solid var(--border-color);margin-left:-1px}#markdown-toc{margin:2rem -1rem 2rem calc(-1rem + 1px);padding-left:2.5rem;padding-bottom:.5rem}#markdown-toc:before{left:1rem}@media screen and (min-width: 1664px){body:not(.no-toc) #markdown-toc{position:absolute;z-index:4;width:20.5rem;right:0;margin:auto;overflow:auto}}@media screen and (min-width: 1664px){body.no-break-layout:not(.no-toc) #markdown-toc{width:calc(50% - 31rem)}}.content{margin-left:auto;margin-right:auto;padding:8rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;min-height:100vh}}@media screen and (min-width: 42em){.content{max-width:42rem}}@media screen and (min-width: 54em){.content{max-width:48rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 86em){.content{padding-top:9rem;margin-left:25rem;margin-right:4rem;max-width:54rem}}@media screen and (min-width: 1664px){.content{margin:auto}}.large-only{display:none}@media screen and (min-width: 1664px){.large-only{display:block}}.avatar{width:7rem;height:7rem;border-radius:100%;overflow:hidden;display:inline-block}.avatar img{width:100%}.content .avatar{float:right;box-sizing:content-box;border:1rem solid var(--body-bg);transition:border-color 1s ease;margin-top:-1.5rem;margin-right:-1rem}.note:before{content:"Note"}.page>header>.note-sm:before,.page>header>.note:before,.page>header>#markdown-toc:before{content:"Description"}#markdown-toc:before{content:"Table of Contents"}.layout-resume .note-sm:before,.layout-resume .note:before,.layout-resume #markdown-toc:before{content:"Summary"}</style><link rel="preload" as="style" href="/assets/css/hydejack-9.1.6.css" id="_stylePreload"><link rel="preload" as="style" href="/assets/icomoon/style.css" id="_iconsPreload"><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload"> <script> setRel('_stylePreload'); setRel('_iconsPreload'); /**/setRel('_fontsPreload');/**/ </script> <noscript><link rel="stylesheet" href="/assets/css/hydejack-9.1.6.css"><link rel="stylesheet" href="/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap"> </noscript><style id="_pageStyle"> html{--accent-color: rgb(79,177,186);--accent-color-faded: rgba(79, 177, 186, 0.5);--accent-color-highlight: rgba(79, 177, 186, 0.1);--accent-color-darkened: #409ba3;--theme-color: rgb(25,55,71)}</style><!--<![endif]--><body class="no-break-layout"> <hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange ><div id="_navbar" class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span><div class="nav-btn-bar"> <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a><div class="nav-span"></div></div></div></div><hr class="sr-only" hidden /><main id="_main" class="content layout-post" role="main" ><nav id="breadcrumbs" class="screen-only"><ul><li><a href="/">home</a><li> <span>/</span> <a href="/posts/">posts</a><li> <span>/</span> <span>openshift-on-aws</span></ul></nav><article id="post-posts-openshift-on-aws" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> Run OpenShift on AWS</h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2022-08-09T07:00:00+00:00">09 Aug 2022</time> on <span>Kubernetes</span>, <span>Openshift</span>, <span>Installation</span> </span></div><div class="hr pb0"></div></header><p><strong>Summary</strong>: Descriptions and simple scripts for supported ways to deploy OpenShift on Amazon Web Services - ROSA, IPI and UPI.<p><img src="../assets/openshift_on_aws/cloud-rose.jpg" width="400px" style="float: right; margin: 5px" alt="a rosy cloud; credit: https://www.pinterest.com/pin/782993085208691059/" /><h2 id="overview">Overview</h2><p>OpenShift is Kubernetes with batteries included and verified - that is, OpenShift is ready to run complex first- and third-party applications and digital workloads as soon as installation is complete. For example, every OpenShift cluster includes a software-defined network provider, a container and source build system and artifact registry, an Internet-facing router and even a system for maintaining and updating cluster components. Contrast this with a cluster provisioned by upstream <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/">kubeadm</a> or even the more featureful <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubespray/">kubespray</a>, where adding these and other critical features requires thoughtful and sometimes fragile integration.<p>Not only does OpenShift offer a ready-to-use Kubernetes environment for developers and operators once deployed, but deployment itself has also become remarkably simple despite the many parts, especially when a cluster is deployed in a public cloud provider like AWS. Gone are the days when operators and infrastructure teams would have to pre-provision hardware and operating systems and carefully configure and patch datacenter networks before cluster installation could even begin. Though it’s still possible to customize OpenShift and its supporting infrastructure to your heart’s content, many use cases can be met with just the defaults, a cloud provider account and a few well-written commands.<p>In this article we’ll discuss three ways to deploy and run OpenShift on Amazon Web Services (AWS), and we’ll contrast these with deploying upstream Kubernetes with kubespray. The methods are presented in order of increasing complexity and customizability: ROSA -&gt; IPI -&gt; UPI -&gt; Kubespray.<p>Follow along and contribute to code at <a href="https://github.com/joshgav/openshift-on-aws.git">https://github.com/joshgav/openshift-on-aws.git</a>.<h2 id="contents">Contents</h2><ol><li><a href="#rosa">Red Hat OpenShift Service on AWS (ROSA)</a><li><a href="#ipi">OpenShift Installer-provisioned infrastructure</a><li><a href="#upi">OpenShift User-provisioned infrastructure</a><li><a href="#kubespray">Kubernetes with Kubespray</a></ol><p><a id="rosa"></a><h2 id="rosa-red-hat-openshift-service-on-aws">ROSA: Red Hat OpenShift Service on AWS</h2><blockquote><p><a href="https://github.com/joshgav/openshift-on-aws/tree/main/rosa">Follow along with scripts</a>.</blockquote><p>Let’s start with the simplest option: Red Hat OpenShift Service on AWS, “ROSA”. A ROSA cluster includes deployment, configuration <em>and</em> management of required compute, network and storage resources in AWS as well as all the resources and services of a OpenShift Kubernetes cluster. As opposed to other options to follow, a ROSA environment is fully supported by Red Hat’s operations teams - open a ticket and an expert Red Hat SRE will attend to it quickly.<h3 id="setup">Setup</h3><p>At the core of the ROSA lifecycle are the <a href="https://docs.openshift.com/rosa/rosa_cli/rosa-get-started-cli.html">rosa CLI</a> tool and the <a href="https://docs.openshift.com/rosa/ocm/ocm-overview.html">OpenShift Cluster Manager</a> (OCM) service (UI: <a href="https://console.redhat.com/openshift">https://console.redhat.com/openshift</a>). Get the CLI from the <a href="https://console.redhat.com/openshift/downloads">Downloads</a> section of the Red Hat Console (free account required) or directly from <a href="https://mirror.openshift.com/pub/openshift-v4/clients/rosa/latest/rosa-linux.tar.gz">https://mirror.openshift.com/pub/openshift-v4/clients/rosa/latest/rosa-linux.tar.gz</a>. Source is at <a href="https://github.com/openshift/rosa">https://github.com/openshift/rosa</a>. The ROSA CLI invokes OCM services as described at <a href="https://api.openshift.com/">https://api.openshift.com/</a>, which in turn provision required infrastructure.<p>You’ll need both Red Hat and AWS credentials to enable the <code class="language-plaintext highlighter-rouge">rosa</code> CLI to provision and connect to resources. Your AWS credentials can be specified as exported <code class="language-plaintext highlighter-rouge">AWS_ACCESS_KEY_ID</code>, <code class="language-plaintext highlighter-rouge">AWS_SECRET_ACCESS_KEY</code> and <code class="language-plaintext highlighter-rouge">AWS_REGION</code> environment variables as <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html">for the AWS CLI</a>.<p>To get a token to login to your Red Hat account, click “View API token” at the bottom of the Downloads page as shown in the following screenshots, or go straight to <a href="https://console.redhat.com/openshift/token">the token page</a>. On that page click “Load token”, then copy the raw token (not the <code class="language-plaintext highlighter-rouge">ocm</code> command line) and run <code class="language-plaintext highlighter-rouge">rosa login --token="${your_token}"</code>. If successful you will see this message (with your username of course): <code class="language-plaintext highlighter-rouge">"I: Logged in as 'joshgavant' on 'https://api.openshift.com'</code>.<p><img src="../assets/openshift_on_aws/console-downloads-token.png" width="300px" /> <img src="../assets/openshift_on_aws/ocm-manage-token.png" width="300px" /><p>To verify that you’ve logged in successfully to both accounts run <code class="language-plaintext highlighter-rouge">rosa whoami</code>. If connections were successful you’ll see a list of attributes about each account.<blockquote><p><strong>Tip</strong>: To quickly enable autocompletion for <code class="language-plaintext highlighter-rouge">rosa</code> commands in your current shell session run <code class="language-plaintext highlighter-rouge">. &lt;(rosa completion)</code>.</blockquote><h3 id="iam-roles">IAM Roles</h3><p>Next you’ll need to create and link AWS IAM roles defining the limited permissions granted to the cluster manager service and Red Hat operations team members. In the recommended “STS” mode, these roles are applied to short-lived tokens issued to machine and human operators on demand.<p>The following commands grant required access to the OpenShift Cluster Manager (OCM) and its installers. The last command creates roles to act as profiles for the EC2 instances. By specifying <code class="language-plaintext highlighter-rouge">--admin</code> and <code class="language-plaintext highlighter-rouge">--mode=auto</code> several additional roles will be automatically created during installation.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosa create <span class="nt">--yes</span> ocm-role <span class="nt">--admin</span> <span class="nt">--mode</span><span class="o">=</span>auto <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"ManagedOpenShift"</span>
rosa create <span class="nt">--yes</span> user-role <span class="nt">--mode</span><span class="o">=</span>auto <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"ManagedOpenShift"</span>
rosa create <span class="nt">--yes</span> account-roles <span class="nt">--mode</span><span class="o">=</span>auto <span class="nt">--prefix</span><span class="o">=</span><span class="s2">"ManagedOpenShift"</span>
</code></pre></div></div><h3 id="create-cluster">Create cluster</h3><p>Now that your Red Hat account is bound to your AWS account you can proceed to create your ROSA cluster! Here we’ll continue to use the rosa CLI; later we’ll mention another approach. Run the following command to create a cluster in <a href="https://docs.openshift.com/rosa/rosa_getting_started/rosa-sts-getting-started-workflow.html">STS mode</a>.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CLUSTER_NAME</span><span class="o">=</span>rosa1
rosa create <span class="nt">--yes</span> cluster <span class="nt">--cluster-name</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CLUSTER_NAME</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--sts</span> <span class="nt">--mode</span><span class="o">=</span>auto <span class="nt">--watch</span>
</code></pre></div></div><p>You can also interactively provide configuration options at cluster creation time by running <code class="language-plaintext highlighter-rouge">rosa create cluster</code> and answering the prompts.<h3 id="monitor-installation">Monitor installation</h3><p>By setting the <code class="language-plaintext highlighter-rouge">--watch</code> flag in the above command installation logs will stream to stdout and the command won’t return till installation completes successfully or fails, typically &gt;30 minutes. You can also start watching logs anytime with <code class="language-plaintext highlighter-rouge">rosa logs install --cluster ${CLUSTER_NAME} --watch</code>.<p>Finally, you can review logs and other attributes of your new cluster in the <a href="https://console.redhat.com/openshift">Red Hat Console</a>. Click into it and expand the “Show logs” section to reach a view like the following:<p><img src="../assets/openshift_on_aws/view-cluster-webui.png" width="300px" /><h3 id="use-cluster">Use cluster</h3><p>Once ready, the easiest way to begin using your cluster immediately is to create a one-off <code class="language-plaintext highlighter-rouge">cluster-admin</code> user as follows. Later you can allow users from a specific OpenIDConnect (OIDC) identity provider using <code class="language-plaintext highlighter-rouge">rosa create oidc-provider ...</code>.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## create a cluster-admin user</span>
rosa create <span class="nt">--yes</span> admin <span class="nt">--cluster</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CLUSTER_NAME</span><span class="k">}</span><span class="s2">"</span>
</code></pre></div></div><p>You’ll need URLs to reach the API server and web console of your new cluster; get those with <code class="language-plaintext highlighter-rouge">rosa list clusters</code>. Finally, log in to the cluster via the <code class="language-plaintext highlighter-rouge">oc</code> CLI: <code class="language-plaintext highlighter-rouge">oc login --user cluster-admin --password ${admin_password}</code>.<h3 id="create-cluster-via-ui">Create cluster via UI</h3><p>Instead of using the <code class="language-plaintext highlighter-rouge">rosa</code> CLI, once your Red Hat and AWS accounts have been linked as described above you can also choose to create a cluster via a guided graphical wizard in the Console. On the <a href="https://console.redhat.com/openshift">Clusters page</a> on the Red Hat Console click “Create cluster”, then on the <a href="https://console.redhat.com/openshift/create">Cluster create page</a> click “Create cluster” next to the ROSA offering, as in the following screenshot:<p><img src="../assets/openshift_on_aws/create-cluster-webui.png" width="300px" /><p>Your AWS account will be listed by its ID on the first page of the wizard. Follow the prompts to configure and install a cluster.<p><a id="ipi"></a><h2 id="installer-provisioned-infrastructure-ipi">Installer-provisioned infrastructure (IPI)</h2><blockquote><p><a href="https://github.com/joshgav/openshift-on-aws/tree/main/ipi">Follow along with scripts</a>.</blockquote><p>Even if your cluster won’t be managed by Red Hat it can still be deployed and configured in AWS automatically with a short list of commands. This method will set up EC2 machines and volumes and VPC networks as well as the cluster itself. It’s known as “Installer-provisioned infrastructure” (IPI); here’s how to do it.<h3 id="setup-1">Setup</h3><p>At the heart of IPI and other OpenShift deployment methods is the <strong>openshift-install</strong> CLI tool. Download it from the <a href="https://console.redhat.com/openshift/downloads#tool-x86_64-openshift-install">downloads section</a> of the OpenShift console, or directly from <a href="https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/stable/openshift-install-linux.tar.gz">https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/stable/openshift-install-linux.tar.gz</a>. Its source is at <a href="https://github.com/openshift/installer">https://github.com/openshift/installer</a>. Run <code class="language-plaintext highlighter-rouge">openshift-install create --help</code> for a list of installation steps, which by default proceed as follows:<ol><li><strong>install-config</strong>: Generate configuration manifest for infrastructure and cluster<li><strong>manifests</strong>: Generate required Kubernetes resource manifests<li><strong>ignition-configs</strong>: Embed Kubernetes resource manifests in OS configuration files<li><strong>cluster</strong>: Provision EC2 machines and bootstrap them with the configuration files created previously</ol><p>You’ll also need a <strong>pull secret</strong> with credentials for Red Hat’s container registries. Copy this from <a href="https://console.redhat.com/openshift/downloads#tool-pull-secret">https://console.redhat.com/openshift/downloads#tool-pull-secret</a>.<p>A <strong>SSH key pair</strong> is required for access to provisioned machines; you’ll need to provide its public key to the installer and save the private key for access. You can copy an existing key from (for example) <code class="language-plaintext highlighter-rouge">~/.ssh/id_rsa.pub</code> or create a new one in a secure place using (for example) <code class="language-plaintext highlighter-rouge">ssh-keygen -t rsa -b 4096 -C "user@openshift" -f "./id_rsa" -N ''</code>. Copy the contents of the <code class="language-plaintext highlighter-rouge">*.pub</code> file as the value of <code class="language-plaintext highlighter-rouge">SSH_PUBLIC_KEY</code> below and save the private key for later.<p>Finally, to be able to access your cluster’s API server and web console by name you’ll need an AWS <strong>Route53 public hosted zone</strong> for your cluster’s base domain name. For example, I delegate a domain named <code class="language-plaintext highlighter-rouge">aws.joshgav.com</code> from my registrar GoDaddy to a new AWS Route53 zone, see following screenshots. Specifically, after creating the Route53 zone I create NS records for <code class="language-plaintext highlighter-rouge">aws</code> in the parent <code class="language-plaintext highlighter-rouge">joshgav.com</code> zone at GoDaddy pointing to the name servers selected by Route53. More details <a href="https://docs.openshift.com/container-platform/4.10/installing/installing_aws/installing-aws-account.html#installation-aws-route53_installing-aws-account">from RedHat here</a> and <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingNewSubdomain.html">from AWS here</a>.<p><img src="../assets/openshift_on_aws/aws-route53.png" width="300px" /> <img src="../assets/openshift_on_aws/godaddy-dns.png" width="300px" /><h3 id="create-cluster-1">Create cluster</h3><p>With these prerequisites in place, you’ll use <code class="language-plaintext highlighter-rouge">openshift-install create ...</code> to manage phases of the installation process. An automatable approach is to define the desired config of your cluster in a file named <code class="language-plaintext highlighter-rouge">install-config.yaml</code>, put it in a directory <code class="language-plaintext highlighter-rouge">${WORKDIR}</code> and run the installer in the context of that directory like so: <code class="language-plaintext highlighter-rouge">openshift-install create cluster --dir ${WORKDIR}</code>. For example, following is a template <code class="language-plaintext highlighter-rouge">install-config.yaml</code> file; use your own values for <code class="language-plaintext highlighter-rouge">OPENSHIFT_PULL_SECRET</code>, <code class="language-plaintext highlighter-rouge">YOUR_DOMAIN_NAME</code> and <code class="language-plaintext highlighter-rouge">SSH_PUBLIC_KEY</code> established above.<blockquote><p>The schema for <code class="language-plaintext highlighter-rouge">install-config.yaml</code> is in</blockquote><p><a href="https://github.com/openshift/installer/blob/master/pkg/types/installconfig.go">https://github.com/openshift/installer/blob/master/pkg/types/installconfig.go</a>.<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ipi</span>
<span class="na">baseDomain</span><span class="pi">:</span> <span class="s">${YOUR_DOMAIN_NAME}</span>
<span class="na">controlPlane</span><span class="pi">:</span>
  <span class="na">architecture</span><span class="pi">:</span> <span class="s">amd64</span>
  <span class="na">hyperthreading</span><span class="pi">:</span> <span class="s">Enabled</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">master</span>
  <span class="na">platform</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
<span class="na">compute</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">architecture</span><span class="pi">:</span> <span class="s">amd64</span>
  <span class="na">hyperthreading</span><span class="pi">:</span> <span class="s">Enabled</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">worker</span>
  <span class="na">platform</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
<span class="na">networking</span><span class="pi">:</span>
  <span class="na">networkType</span><span class="pi">:</span> <span class="s">OVNKubernetes</span>
  <span class="na">clusterNetwork</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">cidr</span><span class="pi">:</span> <span class="s">10.128.0.0/14</span>
    <span class="na">hostPrefix</span><span class="pi">:</span> <span class="m">23</span>
  <span class="na">machineNetwork</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">cidr</span><span class="pi">:</span> <span class="s">10.0.0.0/16</span>
  <span class="na">serviceNetwork</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">172.30.0.0/16</span>
<span class="na">platform</span><span class="pi">:</span>
  <span class="na">aws</span><span class="pi">:</span>
    <span class="na">region</span><span class="pi">:</span> <span class="s">us-east-1</span>
<span class="na">publish</span><span class="pi">:</span> <span class="s">External</span>
<span class="na">pullSecret</span><span class="pi">:</span> <span class="s1">'</span><span class="s">${OPENSHIFT_PULL_SECRET}'</span>
<span class="na">sshKey</span><span class="pi">:</span> <span class="s1">'</span><span class="s">${SSH_PUBLIC_KEY}'</span>
</code></pre></div></div><h3 id="monitor-installation-1">Monitor installation</h3><p>Cluster installation will take 30 minutes or more. Watch logs stream to stdout following the <code class="language-plaintext highlighter-rouge">openshift-install create cluster</code> command, run <code class="language-plaintext highlighter-rouge">openshift-install wait-for install-complete</code>, or tail the <code class="language-plaintext highlighter-rouge">.openshift_install.log</code> file in the installation working directory to track progress of infrastructure and cluster installation.<p>Internally, <code class="language-plaintext highlighter-rouge">openshift-install</code> deploys infrastructure as described in <a href="https://github.com/openshift/installer/tree/master/data/data">these Terraform configs</a>, and many log entries come from Terraform.<h3 id="use-cluster-1">Use cluster</h3><p>A username and password for your cluster will be in the final lines of the install log, either on stdout or in the <code class="language-plaintext highlighter-rouge">.openshift_install.log</code> file in the working directory. In addition, a “kubeconfig” file and the kubeadmin user’s password are saved in the <code class="language-plaintext highlighter-rouge">auth</code> directory of the installation dir. Login to your cluster using one of the following mechanisms:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## using kubeconfig with embedded certificate</span>
<span class="nb">export </span><span class="nv">KUBECONFIG</span><span class="o">=</span>temp/_workdir/auth/kubeconfig

<span class="c">## using username and password</span>
oc login <span class="nt">--user</span> kubeadmin <span class="nt">--password</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">cat </span>temp/_workdir/auth/kubeadmin-password<span class="si">)</span><span class="s2">"</span>

<span class="c">## verify authorization</span>
oc get pods <span class="nt">-A</span>
</code></pre></div></div><p><a id="upi"></a><h2 id="user-provisioned-infrastructure-upi">User-provisioned infrastructure (UPI)</h2><blockquote><p><a href="https://github.com/joshgav/openshift-on-aws/tree/main/upi">Follow along with scripts</a>.</blockquote><p>Though the easiest way to get started with OpenShift on AWS is with ROSA or installer-provisioned infrastructure (IPI), Red Hat also enables you to deploy and configure your own cloud infrastructure - machines, networks, and storage - and provision a cluster on those via a method known as “user-provisioned infrastructure” or UPI.<h3 id="setup-2">Setup</h3><p>Like IPI installations, UPI installations use <code class="language-plaintext highlighter-rouge">openshift-install</code> and the other prerequisites to generate resource manifests and OS configuration files. Unlike IPI though, it’s up to the user to configure machines and supply these files to them when needed. For example, in AWS this is often accomplished by putting configurations in a S3 bucket and asking machines to retrieve them from the bucket’s URL on startup.<h3 id="create-cluster-2">Create cluster</h3><p>To guide users in provisioning their own infrastructure Red Hat provides a set of CloudFormation templates reflecting good patterns for OpenShift clusters; these templates are available <a href="https://github.com/openshift/installer/tree/master/upi/aws/cloudformation">here</a> and the example which accompanies this article uses them.<p>Creating a UPI cluster in AWS follows these high-level steps:<ol><li>Initialize Kubernetes manifests and OS configurations with <code class="language-plaintext highlighter-rouge">openshift-install</code><li>Deploy AWS networks and machines using recommended CloudFormation templates or equivalent mechanisms, bootstrapping machines from generated configurations<li>Await completed installation using <code class="language-plaintext highlighter-rouge">openshift-install</code></ol><p>The AWS resources recommended for OpenShift include a VPC and subnets, a DNS zone and records, load balancers and target groups, IAM roles for EC2 instances, security groups and even an S3 bucket. Several kinds of cluster nodes are also included - bootstrap, control plane and worker. The bootstrap machine starts first and installs the production cluster on the other machines.<p>Full instructions for AWS UPI are <a href="https://docs.openshift.com/container-platform/4.10/installing/installing_aws/installing-aws-user-infra.html">here</a>.<h3 id="monitor-installation-2">Monitor installation</h3><p>Once EC2 instances have started and installation of bootstrap and production clusters has begun, you can monitor progress using <code class="language-plaintext highlighter-rouge">openshift-install wait-for [install-complete | bootstrap-complete]</code> in your working directory. As with other methods installation will probably take more than 30 minutes.<p>One step in cluster provisioning is intentionally difficult to automate - approving Certificate Signing Requests (CSRs) for nodes. Ideally an administrator should verify the provenance of a CSR is the expected node prior to approving the request. You can check if CSRs are awaiting approval with <code class="language-plaintext highlighter-rouge">oc get csr</code>. Approve all pending requests with something like the following:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">csrs</span><span class="o">=(</span><span class="si">$(</span>oc get csr <span class="nt">-o</span> json | jq <span class="nt">-r</span> <span class="s1">'.items[] | select(.status == {}) | .metadata.name'</span><span class="si">)</span><span class="o">)</span>
<span class="k">for </span>csr <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">csrs</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    </span>oc adm certificate approve <span class="s2">"</span><span class="k">${</span><span class="nv">csr</span><span class="k">}</span><span class="s2">"</span>
<span class="k">done</span>
</code></pre></div></div><p>In the sample scripts which accompany this article this check runs in the background while the cluster is being provisioned so that CSRs are immediately approved.<h3 id="use-cluster-2">Use cluster</h3><p>With UPI you don’t use the <code class="language-plaintext highlighter-rouge">openshift-install create cluster</code> command; instead run <code class="language-plaintext highlighter-rouge">openshift-install wait-for install-complete</code> after the installation process has started. Like with IPI you can monitor stdout of this command and/or the <code class="language-plaintext highlighter-rouge">.openshift_install.log</code> file for info on progress of cluster installation. When the cluster is ready, log in as above with <code class="language-plaintext highlighter-rouge">oc login</code> as the kubeadmin user with the password in <code class="language-plaintext highlighter-rouge">${workdir}/auth/kubeadmin-password</code>, or set your KUBECONFIG env var to the path <code class="language-plaintext highlighter-rouge">${workdir}/auth/kubeconfig</code>.<p>Once ready reach the console of your cluster at <code class="language-plaintext highlighter-rouge">https://console-openshift-console.apps.${CLUSTER_NAME}.${BASE_DOMAIN}/</code>.<p><a id="kubespray"></a><h2 id="kubespray">Kubespray</h2><blockquote><p><a href="https://github.com/joshgav/openshift-on-aws/tree/main/kubespray">Follow along with scripts</a>.</blockquote><p>The previous sections described how to deploy OpenShift, Red Hat’s Kubernetes distribution, on Amazon Web Services with various levels of support and automation for provisioning and operation. In this section we’ll deploy upstream Kubernetes using <a href="https://kubespray.io">Kubespray</a> to compare, contrast and gather new ideas. Notably, kubespray’s included configuration for AWS infrastructure yields the following environment, nearly identical to that produced by openshift-install and ROSA.<p><img src="../assets/openshift_on_aws/aws-kubespray.png" width="400px" alt="kubespray AWS infrastructure; credit: https://github.com/kubernetes-sigs/kubespray/blob/master/contrib/terraform/aws/docs/aws_kubespray.png" /><p>As with user-provisioned infrastructure (UPI) for OpenShift, with Kubespray the user first installs infrastructure as they will (e.g. with Terraform or CloudFormation) and then uses Kubespray to install a cluster on that infrastructure. Kubespray offers Terraform configurations for deploying typical environments in cloud providers; for this example I used the <a href="https://github.com/kubernetes-sigs/kubespray/tree/master/contrib/terraform/aws">configurations for AWS</a>.<blockquote><p>Note: The most basic cluster installation tool is <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">kubeadm</a>, but it leaves many critical aspects of the cluster incomplete, such as a network overlay, container registry and load balancer controller. <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubespray/">Kubespray</a> is also maintained by the Kubernetes project and provides a more complete deployment.</blockquote><h2 id="create-cluster-3">Create cluster</h2><p>The last step of infrastructure provisioning creates an inventory file for Ansible to consume to deploy cluster components. When infrastructure is deployed and that file is ready run the main Kubespray process - an Ansible playbook - using that inventory, e.g.: <code class="language-plaintext highlighter-rouge">ansible-playbook -i hosts.ini cluster.yaml</code>. Customize the deployment by changing variables in inventory vars files or by passing <code class="language-plaintext highlighter-rouge">-e key=value</code> pairs to the ansible-playbook invocation. Check out the the <code class="language-plaintext highlighter-rouge">deploy-cluster.sh</code> script in the walkthrough for examples.<p>Rather than installing the Kubespray Ansible environment locally, you may prefer to run commands in a containerized process bound to your inventory and SSH files, for example as follows:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>podman run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="se">\</span>
    <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>kubespray/inventory/cluster,dst<span class="o">=</span>/inventory,relabel<span class="o">=</span>shared <span class="se">\</span>
    <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>.ssh/id_rsa,dst<span class="o">=</span>/root/.ssh/id_rsa,relabel<span class="o">=</span>shared <span class="se">\</span>
        quay.io/kubespray/kubespray:v2.19.0 <span class="se">\</span>
            bash

<span class="c"># when prompted, enter (for example):</span>
ansible-playbook cluster.yml <span class="se">\</span>
    <span class="nt">-i</span> /inventory/hosts.ini <span class="se">\</span>
    <span class="nt">--private-key</span> /root/.ssh/id_rsa <span class="se">\</span>
    <span class="nt">--become</span> <span class="nt">--become-user</span><span class="o">=</span>root <span class="se">\</span>
    <span class="nt">-e</span> <span class="s2">"kube_version=v1.23.7"</span> <span class="se">\</span>
    <span class="nt">-e</span> <span class="s2">"ansible_user=ec2-user"</span> <span class="se">\</span>
    <span class="nt">-e</span> <span class="s2">"kubeconfig_localhost=true"</span>
</code></pre></div></div><h3 id="use-cluster-3">Use cluster</h3><p>The Ansible variable <code class="language-plaintext highlighter-rouge">kubeconfig_localhost=true</code> indicates that a kubeconfig file with credentials for the provisioned cluster should be written to the inventory directory once the cluster is ready. You can use this config to authenticate to the cluster’s API server and invoke <code class="language-plaintext highlighter-rouge">kubectl</code> commands.<p>Initially the kubeconfig file will use an AWS-internal IP address for the location of the API server. To manage your cluster from outside AWS you’ll need to change the server’s URL to the address of your externally-accessible load balancer (provisioned by Terraform previously). You can find the external load balancer URL with the command <code class="language-plaintext highlighter-rouge">aws elbv2 describe-load-balancers --output json | jq -r '.LoadBalancers[0].DNSName'</code>. Replace the server URL in the kubeconfig file with this hostname, being sure to prepend <code class="language-plaintext highlighter-rouge">https://</code> and append <code class="language-plaintext highlighter-rouge">:6443/</code>.<p>Finally, set your KUBECONFIG env var to the file’s path, i.e. <code class="language-plaintext highlighter-rouge">export KUBECONFIG=inventory/cluster/artifacts/admin.conf</code> and then run <code class="language-plaintext highlighter-rouge">kubectl get pods -A</code>. If all is well you should get a list of all pods in the cluster.<h2 id="conclusion">Conclusion</h2><p>In this article and <a href="https://github.com/joshgav/openshift-on-aws.git">accompanying code</a> we’ve discussed and demonstrated how to deploy an OpenShift or upstream Kubernetes cluster in AWS using four different methods which progress from simplest with least control to most complex yet customizable: ROSA -&gt; IPI -&gt; UPI -&gt; Kubespray.<p>To minimize the complexity and overhead of managing your own clouds and clusters, start with the simplest method - ROSA - and progress to others as greater control and customization is needed.<p>Please provide feedback in <a href="https://github.com/joshgav/openshift-on-aws/">the repo</a> or on <a href="https://twitter.com/joshugav">Twitter</a>. Thank you!</article><hr class="dingbat related mb6" /><aside class="related mb4" role="complementary"><h2 class="hr-bottom">Related Posts</h2><ul class="related-posts"><li class="h4"> <a href="/posts/orchestrate-platforms-on-kubernetes" class="flip-title"><span>Orchestrate platforms with Kubernetes</span></a> <time class="faded fine" datetime="2023-10-14T22:00:00+00:00">14 Oct 2023</time><li class="h4"> <a href="/posts/kubecon-amsterdam" class="flip-title"><span>Kubecon Amsterdam Learnings</span></a> <time class="faded fine" datetime="2023-05-08T07:00:00+00:00">08 May 2023</time><li class="h4"> <a href="/posts/kubecon-platforms-review" class="flip-title"><span>Platforms at Kubecon 2022</span></a> <time class="faded fine" datetime="2022-10-31T07:00:00+00:00">31 Oct 2022</time></ul></aside><footer class="content" role="contentinfo"><hr/><p><small class="copyright">© 2021. All rights reserved. </small><p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">9.1.6</span></small><hr class="sr-only"/></footer></main><hy-drawer id="_drawer" class="" side="left" threshold="10" noscroll ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(25,55,71);background-image:url(/assets/img/sidebar-bg.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="sidebar-title" href="/"><h2 class="h1">Partly Cloudy</h2></a><p class=""> A blog about cloud infrastructure and cloud-native application patterns and practices.</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_drawer--opened" href="/about" class="sidebar-nav-item " > About Josh </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social</span><ul><li> <a href="https://twitter.com/joshugav" title="Twitter" class="no-mark-external"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/joshgav" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="mailto:joshgavant@gmail.com" title="Email" class="no-mark-external"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if gt IE 10]><!----> <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}(); </script> <script src="/assets/js/hydejack-9.1.6.js" type="module"></script> <script src="/assets/js/LEGACY-hydejack-9.1.6.js" nomodule defer></script> <!--<![endif]--><div hidden><h2 class="sr-only">Templates:</h2><template id="_animation-template"><div class="animation-main fixed-top"><nav id="breadcrumbs" class="screen-only"><ul></ul></nav><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading: <a class="this-link" href=""></a>.</div></template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="content-hash"></span> </a> </template></div></html>
